<link rel="import" href="../my_components/content-page.html">
<link rel="import" href="../my_components/video-card.html">

<polymer-element name="list-cards" attributes="groups fireToggle cardWidth" center-justified vertical layout>
<template>
	<style>
		:host {
			position: absolute;			
			width: 100%;
			height: 100%;
			top: 0;			
		}

		.main-panel {				
			position: absolute;
			width: 100%;
			height: 100%;
			top: 0;
		}		

		 #noscroll {
	      	position: absolute;
	      	top: 0;
	        right: 0;
	        left: 0;	      
	    }

		.item-list {	
			position: absolute;				
			left: 0;
			right: 0;
			top: 20px;	
			width: 100%;								
			margin-bottom: 40px;
		}					

		content-page {
			position: absolute;
			top: -200px;				
			right: -1100px;			
		}
	</style>
	<div class="main-panel" center-justified vertical layout>		
		<section vertical layout>
			<div id="noscroll" fit hero-p>
				<div class="item-list" flex horizontal around-justified layout wrap>			
					<template repeat="{{group, i in groups}}">							
						<video-card cardWidth="{{cardWidth}}" groups="{{groups}}" group="{{group}}" groupId="{{i}}" on-card-tapped="{{changePage}}" selectedGroup="{{selectedGroup}}"></video-card>
					</template>					
				</div>
			</div>
		</section>				
	</div>
	<content-page id="contentPage" on-content-back="{{changePage}}" group="{{selectedGroup}}" groupId="{{group_id}}" hidden></content-page> 	
</template>
<script>
	Polymer('list-cards', {
		selected: 0,
		group_id: -1,
		groups: [],		
		player: false,		
		isOpened: true,			
		fireToggle: true,	
		selectedGroup: [],					

		created: function() {
			this.selectedGroup = [];	
		},

		transitionend: function(e) {

		},

		fireToggleChanged: function() {
			this.changePage();
		},		

		changePage: function(event) {			
			if(this.selected===0) {
				this.selected = 1;				
			} else {
				this.selected = 0;
			}
			this.toggleContentPage();
		},

		toggleContentPage: function() {
			var that = this;
			if(this.player) {
				this.player.cancel();
			}
			
			var animation = new CoreAnimation();			
			animation.addEventListener("core-animation-finish", function() {				
				if(that.isOpened){
					that.$.contentPage.setAttribute("hidden", null);
				}				
			});
			animation.duration = 400;
			animation.easing = "ease-in-out";
			animation.keyframes = [
				{right: "0px"},
				{right: "-1100px"}
			];
			animation.fill = "forwards";
			if(this.isOpened){				
				this.$.contentPage.removeAttribute("hidden");
				animation.direction = "reverse";
				this.isOpened = false;			
				this.fire('show-content');
			} else {								
				animation.direction = "normal";
				this.isOpened = true;				
				this.fire('hide-content');
			}						
			animation.target = this.$.contentPage;
			this.player = animation.play();			
		}
	});
</script>
</polymer-element>
